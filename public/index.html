<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>CRUD</title>
</head>
<body>
<h2>ğŸ‘¤ ì‚¬ìš©ì ë“±ë¡</h2>
<input id="name" placeholder="ì´ë¦„">
<input id="id" placeholder="ì•„ì´ë””">
<input id="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
<button onclick="createUser()">ë“±ë¡</button>

<h2>ğŸ“‹ ì‚¬ìš©ì ëª©ë¡</h2>
<button onclick="loadUsers()">ìƒˆë¡œê³ ì¹¨</button>
<table border="1" cellpadding="5">
    <thead>
    <tr>
        <th>user_id</th>
        <th>name</th>
        <th>id</th>
        <th>password</th>
        <th>ìˆ˜ì •</th>
        <th>ì‚­ì œ</th>
    </tr>
    </thead>
    <tbody id="userTableBody"></tbody>
</table>

<script>
    const API_URL = 'http://localhost:3000/api/users';

    // ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
    async function loadUsers() {
        const res = await fetch(API_URL);
        const users = await res.json();
        console.log(users);
        const tbody = document.getElementById('userTableBody');
        tbody.innerHTML = '';

        users.forEach(user => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${user.USER_ID}</td>
                <td><input value="${user.NAME}" id="name-${user.USER_ID}"></td>
                <td><input value="${user.ID}" id="id-${user.USER_ID}"></td>
                <td><input value="${user.PASSWORD}" id="password-${user.USER_ID}"></td>
                <td><button onclick="updateUser(${user.USER_ID})">ìˆ˜ì •</button></td>
                <td><button onclick="deleteUser(${user.USER_ID})">ì‚­ì œ</button></td>
            `;
            tbody.appendChild(tr);
        });
    }

    // ì‚¬ìš©ì ë“±ë¡
    async function createUser() {
        const name = document.getElementById('name').value;
        const id = document.getElementById('id').value;
        const password = document.getElementById('password').value;

        const res = await fetch(API_URL, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name, id, password})
        });
        const result = await res.json();
        console.log("ë“±ë¡ ì‘ë‹µ:", result);
        alert(result.message);
        loadUsers();
    }

    // ì‚¬ìš©ì ìˆ˜ì •
    async function updateUser(user_id) {
        const name = document.getElementById(`name-${user_id}`).value;
        const id = document.getElementById(`id-${user_id}`).value;
        const password = document.getElementById(`password-${user_id}`).value;

        const res = await fetch(`${API_URL}/${user_id}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name, id, password})
        });
        const result = await res.json();
        console.log("ìˆ˜ì • ì‘ë‹µ:", result);
        alert(result.message);
        loadUsers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
    }

    // ì‚¬ìš©ì ì‚­ì œ
    async function deleteUser(user_id) {
        if (!confirm(`${user_id}ë²ˆ ì‚¬ìš©ìë¥¼ ì‚­ì œí• ê¹Œìš”?`)) return;
        console.log('ì‚­ì œí•  user_id:', user_id);

        const res = await fetch(`${API_URL}/${user_id}`, {method: 'DELETE'});
        const result = await res.json();
        console.log("ì‚­ì œ ì‘ë‹µ:", result);
        alert(result.message);
        loadUsers(); // ëª©ë¡ ìƒˆë¡œê³ ì¹¨
    }

    loadUsers();
</script>
</body>
</html>
