<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Book-Cycle ì‚¬ìš©ì ê´€ë¦¬</title>
</head>
<body>
<h1>ğŸ“š Book-Cycle ì‚¬ìš©ì ê´€ë¦¬</h1>

<!-- âœ… íšŒì›ê°€ì… -->
<h2>ğŸ‘¤ íšŒì›ê°€ì…</h2>
<input id="signup-name" placeholder="ì´ë¦„">
<input id="signup-id" placeholder="ì•„ì´ë””">
<input id="signup-password" placeholder="ë¹„ë°€ë²ˆí˜¸" type="password">
<button onclick="createUser()">íšŒì›ê°€ì…</button>

<!-- âœ… ë¡œê·¸ì¸ -->
<h2>ğŸ” ë¡œê·¸ì¸</h2>
<input id="login-id" placeholder="ì•„ì´ë””">
<input id="login-password" placeholder="ë¹„ë°€ë²ˆí˜¸" type="password">
<button onclick="loginUser()">ë¡œê·¸ì¸</button>

<!-- âœ… ì‚¬ìš©ì ëª©ë¡ -->
<h2>ğŸ“‹ ì‚¬ìš©ì ëª©ë¡</h2>
<button onclick="loadUsers()">ìƒˆë¡œê³ ì¹¨</button>
<table border="1" cellpadding="5">
    <thead>
    <tr>
        <th>user_id</th>
        <th>name</th>
        <th>id</th>
        <th>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</th>
        <th>ìˆ˜ì •</th>
        <th>ì‚­ì œ</th>
    </tr>
    </thead>
    <tbody id="userTableBody"></tbody>
</table>

<script>
    const API_URL = 'http://localhost:3000/api/users';
    const LOGIN_URL = 'http://localhost:3000/api/login';

    // âœ… ì‚¬ìš©ì ëª©ë¡ ì¡°íšŒ
    async function loadUsers() {

        // console.log("ì „ì²´ ì‚¬ìš©ì ëª©ë¡:", user);

        const res = await fetch(API_URL);
        const users = await res.json();
        const tbody = document.getElementById('userTableBody');
        tbody.innerHTML = '';

        users.forEach(user => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${user.USER_ID}</td>
                <td><input value="${user.NAME}" id="name-${user.USER_ID}"></td>
                <td><input value="${user.ID}" id="id-${user.USER_ID}"></td>
                <td><input placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸" id="password-${user.USER_ID}" type="password"></td>
                <td><button onclick="updateUser(${user.USER_ID})">ìˆ˜ì •</button></td>
                <td><button onclick="deleteUser(${user.USER_ID})">ì‚­ì œ</button></td>
            `;
            tbody.appendChild(tr);
        });
    }

    // âœ… íšŒì›ê°€ì…
    async function createUser() {
        const name = document.getElementById('signup-name').value;
        const id = document.getElementById('signup-id').value;
        const password = document.getElementById('signup-password').value;

        const res = await fetch(API_URL, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name, id, password})
        });

        const result = await res.json();
        alert(result.message || 'íšŒì›ê°€ì… ì™„ë£Œ');
        loadUsers();
    }

    // âœ… ë¡œê·¸ì¸
    async function loginUser() {
        const id = document.getElementById('login-id').value;
        const password = document.getElementById('login-password').value;

        const res = await fetch('http://localhost:3000/api/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({id, password})
        });

        if (!res.ok) {
            // ì—ëŸ¬ ë©”ì‹œì§€ ë°›ê¸°
            const errorData = await res.json();
            alert(errorData.message || 'ë¡œê·¸ì¸ ì‹¤íŒ¨');
            return;
        }

        const data = await res.json();
        alert(data.message);
        // í† í° ì²˜ë¦¬ ë“± ë¡œê·¸ì¸ ì„±ê³µ í›„ ì‘ì—…
    }


    // âœ… ì‚¬ìš©ì ìˆ˜ì •
    async function updateUser(user_id) {
        const name = document.getElementById(`name-${user_id}`).value;
        const id = document.getElementById(`id-${user_id}`).value;
        const password = document.getElementById(`password-${user_id}`).value;

        const body = {name, id};
        if (password.trim()) body.password = password;

        const res = await fetch(`${API_URL}/${user_id}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(body)
        });

        const result = await res.json();
        alert(result.message);
        loadUsers();
    }

    // âœ… ì‚¬ìš©ì ì‚­ì œ
    async function deleteUser(user_id) {
        if (!confirm(`${user_id}ë²ˆ ì‚¬ìš©ìë¥¼ ì‚­ì œí• ê¹Œìš”?`)) return;

        const res = await fetch(`${API_URL}/${user_id}`, {method: 'DELETE'});
        const result = await res.json();
        alert(result.message);
        loadUsers();
    }

    // ì´ˆê¸° ë¡œë“œ
    loadUsers();
</script>
</body>
</html>
