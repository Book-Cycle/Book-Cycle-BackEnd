<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>CRUD</title>
</head>
<body>
<h2>👤 사용자 등록</h2>
<input id="name" placeholder="이름">
<input id="id" placeholder="아이디">
<input id="password" placeholder="비밀번호">
<button onclick="createUser()">등록</button>

<h2>📋 사용자 목록</h2>
<button onclick="loadUsers()">새로고침</button>
<table border="1" cellpadding="5">
    <thead>
    <tr>
        <th>user_id</th>
        <th>name</th>
        <th>id</th>
        <th>password</th>
        <th>수정</th>
        <th>삭제</th>
    </tr>
    </thead>
    <tbody id="userTableBody"></tbody>
</table>

<script>
    const API_URL = 'http://localhost:3000/api/users';

    // 사용자 목록 조회
    async function loadUsers() {
        const res = await fetch(API_URL);
        const users = await res.json();
        console.log(users);
        const tbody = document.getElementById('userTableBody');
        tbody.innerHTML = '';

        users.forEach(user => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${user.USER_ID}</td>
                <td><input value="${user.NAME}" id="name-${user.USER_ID}"></td>
                <td><input value="${user.ID}" id="id-${user.USER_ID}"></td>
                <td><input value="${user.PASSWORD}" id="password-${user.USER_ID}"></td>
                <td><button onclick="updateUser(${user.USER_ID})">수정</button></td>
                <td><button onclick="deleteUser(${user.USER_ID})">삭제</button></td>
            `;
            tbody.appendChild(tr);
        });
    }

    // 사용자 등록
    async function createUser() {
        const name = document.getElementById('name').value;
        const id = document.getElementById('id').value;
        const password = document.getElementById('password').value;

        const res = await fetch(API_URL, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name, id, password})
        });
        const result = await res.json();
        console.log("등록 응답:", result);
        alert(result.message);
        loadUsers();
    }

    // 사용자 수정
    async function updateUser(user_id) {
        const name = document.getElementById(`name-${user_id}`).value;
        const id = document.getElementById(`id-${user_id}`).value;
        const password = document.getElementById(`password-${user_id}`).value;

        const res = await fetch(`${API_URL}/${user_id}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({name, id, password})
        });
        const result = await res.json();
        console.log("수정 응답:", result);
        alert(result.message);
        loadUsers(); // 목록 새로고침
    }

    // 사용자 삭제
    async function deleteUser(user_id) {
        if (!confirm(`${user_id}번 사용자를 삭제할까요?`)) return;
        console.log('삭제할 user_id:', user_id);

        const res = await fetch(`${API_URL}/${user_id}`, {method: 'DELETE'});
        const result = await res.json();
        console.log("삭제 응답:", result);
        alert(result.message);
        loadUsers(); // 목록 새로고침
    }

    loadUsers();
</script>
</body>
</html>
